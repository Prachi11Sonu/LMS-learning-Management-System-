{% extends 'base.html' %}

{% block title %}
    {% if review_type == 'course' %}
        Review Course - {{ course.title }}
    {% else %}
        Review Instructor - {{ instructor.get_full_name }}
    {% endif %} - EduFlow
{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 2rem auto;">
    <div style="background: white; border-radius: 24px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.1);">
        <!-- Header -->
        <div style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); padding: 2rem; color: white;">
            <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
                {% if review_type == 'course' %}
                    Review Course
                {% else %}
                    Review Instructor
                {% endif %}
            </h1>
            {% if review_type == 'course' %}
                <p style="opacity: 0.9;">Share your experience with "{{ course.title }}"</p>
            {% else %}
                <p style="opacity: 0.9;">Share your experience with instructor {{ instructor.get_full_name }}</p>
            {% endif %}
        </div>
        
        <!-- Review Form -->
        <div style="padding: 2rem;">
            {% if existing_review %}
            <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 12px; padding: 1rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-info-circle" style="color: #0284c7;"></i>
                <span style="color: #0369a1;">You already have a review. You can edit it below.</span>
            </div>
            {% endif %}
            
            <form method="post" id="reviewForm">
                {% csrf_token %}
                
                <!-- Rating Slider -->
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 1rem; color: #0f172a;">
                        {{ form.rating.label }} <span style="color: #ef4444;">*</span>
                    </label>
                    
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="flex: 1; position: relative;">
                            <input type="range" name="rating" id="ratingSlider" min="1" max="5" step="1" 
                                   value="{{ form.rating.value|default:'3' }}" 
                                   style="width: 100%; height: 8px; background: linear-gradient(90deg, #f59e0b 0%, #f59e0b var(--value), #e2e8f0 var(--value), #e2e8f0 100%); border-radius: 10px; -webkit-appearance: none;"
                                   oninput="updateRatingStars(this.value)">
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                                <span style="font-size: 0.8rem; color: #64748b;">Poor</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Fair</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Good</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Very Good</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Excellent</span>
                            </div>
                        </div>
                        
                        <div id="starDisplay" style="font-size: 2rem; color: #f59e0b; min-width: 120px; text-align: center;">
                            ★★★★☆
                        </div>
                    </div>
                    {% if form.rating.errors %}
                    <div style="color: #ef4444; font-size: 0.9rem; margin-top: 0.5rem;">{{ form.rating.errors.0 }}</div>
                    {% endif %}
                </div>
                
                {% if review_type == 'course' %}
                <!-- Course Review Specific Fields -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #0f172a;">Review Title</label>
                    {{ form.title }}
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #0f172a;">Your Review</label>
                    {{ form.comment }}
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                        {{ form.would_recommend }}
                        <span style="color: #334155;">I would recommend this course to others</span>
                    </label>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 1rem; color: #0f172a;">
                        {{ form.difficulty_rating.label }}
                    </label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="flex: 1;">
                            <input type="range" name="difficulty_rating" id="difficultySlider" min="1" max="5" step="1" 
                                   value="{{ form.difficulty_rating.value|default:'3' }}" 
                                   style="width: 100%;"
                                   oninput="updateDifficulty(this.value)">
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                                <span style="font-size: 0.8rem; color: #64748b;">Very Easy</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Easy</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Moderate</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Hard</span>
                                <span style="font-size: 0.8rem; color: #64748b;">Very Hard</span>
                            </div>
                        </div>
                        <div id="difficultyDisplay" style="font-size: 1.5rem; font-weight: 600; color: #8b5cf6; min-width: 80px; text-align: center;">
                            Moderate
                        </div>
                    </div>
                </div>
                
                {% else %}
                <!-- Instructor Review Specific Fields -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #0f172a;">Teaching Clarity</label>
                    <input type="range" name="clarity_rating" min="1" max="5" step="1" 
                           value="{{ form.clarity_rating.value|default:'4' }}" 
                           style="width: 100%;"
                           oninput="document.getElementById('clarityValue').innerHTML = this.value + '★'">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Poor</span>
                        <span id="clarityValue">4★</span>
                        <span>Excellent</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #0f172a;">Responsiveness to Questions</label>
                    <input type="range" name="responsiveness_rating" min="1" max="5" step="1" 
                           value="{{ form.responsiveness_rating.value|default:'4' }}" 
                           style="width: 100%;"
                           oninput="document.getElementById('responsivenessValue').innerHTML = this.value + '★'">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Poor</span>
                        <span id="responsivenessValue">4★</span>
                        <span>Excellent</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #0f172a;">Your Comments</label>
                    {{ form.comment }}
                </div>
                {% endif %}
                
                <!-- Submit Buttons -->
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn" style="flex: 1; background: linear-gradient(135deg, #8b5cf6, #14b8a6); color: white; padding: 1rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;">
                        {% if existing_review %}Update Review{% else %}Submit Review{% endif %}
                    </button>
                    
                    <a href="{% url 'courses:course_detail' course.slug %}" 
                       style="flex: 1; background: white; color: #334155; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; text-align: center; text-decoration: none; font-weight: 600;">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function updateRatingStars(value) {
        const stars = '★'.repeat(value) + '☆'.repeat(5 - value);
        document.getElementById('starDisplay').innerHTML = stars;
        
        // Update slider background
        const slider = document.getElementById('ratingSlider');
        const percentage = (value - 1) * 25;
        slider.style.background = `linear-gradient(90deg, #f59e0b 0%, #f59e0b ${percentage}%, #e2e8f0 ${percentage}%, #e2e8f0 100%)`;
    }
    
    function updateDifficulty(value) {
        const labels = ['Very Easy', 'Easy', 'Moderate', 'Hard', 'Very Hard'];
        document.getElementById('difficultyDisplay').innerHTML = labels[value - 1];
    }
    
    // Initialize on page load
    window.onload = function() {
        const ratingSlider = document.getElementById('ratingSlider');
        if (ratingSlider) {
            updateRatingStars(ratingSlider.value);
        }
        
        const difficultySlider = document.getElementById('difficultySlider');
        if (difficultySlider) {
            updateDifficulty(difficultySlider.value);
        }
    };
</script>

<style>
    input[type=range] {
        height: 8px;
        -webkit-appearance: none;
        background: #e2e8f0;
        border-radius: 10px;
        outline: none;
    }
    
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 24px;
        height: 24px;
        background: white;
        border: 2px solid #8b5cf6;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
        transition: transform 0.2s;
    }
    
    input[type=range]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
    }
</style>
{% endblock %}