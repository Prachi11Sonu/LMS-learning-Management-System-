{% extends 'base.html' %}

{% block title %}{{ course.title }} - EduFlow{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 2rem auto;">
    <!-- Course Header with Gradient -->
    <div style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); border-radius: 30px; padding: 3rem; color: white; margin-bottom: 2rem; position: relative; overflow: hidden;">
        <!-- Decorative Elements -->
        <div style="position: absolute; top: -30%; right: -10%; width: 50%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%); border-radius: 50%;"></div>
        <div style="position: absolute; bottom: -30%; left: -10%; width: 50%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%); border-radius: 50%;"></div>
        
        <div style="position: relative; z-index: 2;">
            <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 2rem;">
                <div style="flex: 1; min-width: 300px;">
                    <!-- Breadcrumb -->
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                        <a href="{% url 'courses:course_list' %}" style="color: white; text-decoration: none;">Courses</a>
                        <i class="fas fa-chevron-right" style="font-size: 0.7rem;"></i>
                        <span>{{ course.title }}</span>
                    </div>
                    
                    <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; line-height: 1.2;">{{ course.title }}</h1>
                    <p style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 1.5rem;">{{ course.short_description }}</p>
                    
                    <!-- Course Meta Info -->
                    <div style="display: flex; flex-wrap: wrap; gap: 2rem; margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">Instructor</div>
                                <div style="font-weight: 600;">{{ course.instructor.get_full_name }}</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">Lessons</div>
                                <div style="font-weight: 600;">{{ lessons|length }} lessons</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">Total Duration</div>
                                <div style="font-weight: 600;">{{ total_duration }} minutes</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">Students</div>
                                <div style="font-weight: 600;">{{ course.total_enrollments }} enrolled</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-star"></i>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">Rating</div>
                                <div style="font-weight: 600;">{{ course.average_rating|floatformat:1 }} ({{ course.total_reviews }} reviews)</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Category and Level Badges -->
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                        <span style="background: rgba(255,255,255,0.2); padding: 0.4rem 1.2rem; border-radius: 50px; font-size: 0.9rem; backdrop-filter: blur(5px);">
                            <i class="fas fa-tag" style="margin-right: 0.5rem;"></i>{{ course.category.name }}
                        </span>
                        <span style="background: rgba(255,255,255,0.2); padding: 0.4rem 1.2rem; border-radius: 50px; font-size: 0.9rem; backdrop-filter: blur(5px);">
                            <i class="fas fa-signal" style="margin-right: 0.5rem;"></i>{{ course.get_level_display }}
                        </span>
                        {% if course.is_free %}
                        <span style="background: #10b981; padding: 0.4rem 1.2rem; border-radius: 50px; font-size: 0.9rem;">
                            <i class="fas fa-gift"></i> Free
                        </span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Price and Action Card -->
                <div style="background: white; border-radius: 20px; padding: 2rem; min-width: 280px; color: #0f172a; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 2.5rem; font-weight: 800; color: #8b5cf6; margin-bottom: 0.5rem;">
                            {% if course.is_free %}Free{% else %}₹{{ course.price }}{% endif %}
                        </div>
                        <p style="color: #64748b;">One-time payment, lifetime access</p>
                    </div>
                    
                    {% if user.is_authenticated %}
                        {% if is_enrolled %}
                        <a href="{% if lessons.first %}{% url 'courses:lesson_detail' course.slug lessons.first.id %}{% else %}#{% endif %}" 
                           style="display: block; background: linear-gradient(135deg, #10b981, #059669); color: white; text-align: center; padding: 1rem; border-radius: 12px; text-decoration: none; font-weight: 600; margin-bottom: 1rem;">
                            <i class="fas fa-play-circle"></i> Start Learning
                        </a>
                        <p style="text-align: center; color: #10b981; font-size: 0.9rem;">
                            <i class="fas fa-check-circle"></i> You're enrolled in this course
                        </p>
                        {% elif user.is_student %}
                        <form method="post" action="{% url 'enrollments:enroll_course' course.id %}">
                            {% csrf_token %}
                            <button type="submit" 
                                    style="width: 100%; background: linear-gradient(135deg, #8b5cf6, #14b8a6); color: white; padding: 1rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                                <i class="fas fa-graduation-cap"></i> Enroll Now
                            </button>
                        </form>
                        {% endif %}
                        
                        <!-- Instructor Actions Section with Delete Button -->
                        {% if user.is_instructor and course.instructor == user %}
                        <div style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{% url 'courses:course_update' course.pk %}" 
                                   style="flex: 1; background: #f1f5f9; color: #334155; text-align: center; padding: 0.75rem; border-radius: 10px; text-decoration: none; font-size: 0.9rem;">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <a href="{% url 'courses:manage_lessons' course.id %}" 
                                   style="flex: 1; background: #f1f5f9; color: #334155; text-align: center; padding: 0.75rem; border-radius: 10px; text-decoration: none; font-size: 0.9rem;">
                                    <i class="fas fa-list"></i> Lessons
                                </a>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{% url 'courses:course_students' course.id %}" 
                                   style="flex: 1; background: #f1f5f9; color: #334155; text-align: center; padding: 0.75rem; border-radius: 10px; text-decoration: none; font-size: 0.9rem;">
                                    <i class="fas fa-users"></i> Students
                                </a>
                                <a href="{% url 'courses:course_delete' course.pk %}" 
                                   style="flex: 1; background: #fee2e2; color: #dc2626; text-align: center; padding: 0.75rem; border-radius: 10px; text-decoration: none; font-size: 0.9rem;"
                                   onclick="return confirm('Are you sure you want to delete this course? This action cannot be undone.');">
                                    <i class="fas fa-trash"></i> Delete
                                </a>
                            </div>
                        </div>
                        {% endif %}
                        
                    {% else %}
                    <a href="{% url 'accounts:login' %}?next={{ request.path }}" 
                       style="display: block; background: linear-gradient(135deg, #8b5cf6, #14b8a6); color: white; text-align: center; padding: 1rem; border-radius: 12px; text-decoration: none; font-weight: 600;">
                        <i class="fas fa-sign-in-alt"></i> Login to Enroll
                    </a>
                    {% endif %}
                    
                    <!-- Guarantee -->
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: 1rem; color: #64748b; font-size: 0.8rem;">
                        <i class="fas fa-shield-alt"></i>
                        <span>30-day money-back guarantee</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
        <!-- Left Column - Course Details -->
        <div>
            <!-- About This Course -->
            <div style="background: white; border-radius: 20px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 8px 30px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <h2 style="font-size: 1.5rem; font-weight: 700; color: #0f172a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-info-circle" style="color: #8b5cf6;"></i>
                    About This Course
                </h2>
                <p style="color: #334155; line-height: 1.8; margin-bottom: 2rem;">{{ course.description }}</p>
                
                <!-- What You'll Learn -->
                <div style="background: #f8fafd; border-radius: 16px; padding: 1.5rem;">
                    <h3 style="font-weight: 600; margin-bottom: 1rem; color: #0f172a;">What you'll learn</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-check-circle" style="color: #10b981;"></i>
                            <span>Master core concepts</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-check-circle" style="color: #10b981;"></i>
                            <span>Build real projects</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-check-circle" style="color: #10b981;"></i>
                            <span>Get certified</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-check-circle" style="color: #10b981;"></i>
                            <span>Lifetime access</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Content - Lessons Section (CLICKABLE LESSONS) -->
            <div style="background: white; border-radius: 20px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 8px 30px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.5rem; font-weight: 700; color: #0f172a; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-list" style="color: #8b5cf6;"></i>
                        Course Content ({{ lessons|length }} lessons)
                    </h2>
                    
                    {% if user.is_instructor and course.instructor == user %}
                    <a href="{% url 'courses:manage_lessons' course.id %}" 
                       style="background: #8b5cf6; color: white; padding: 0.6rem 1.25rem; border-radius: 50px; text-decoration: none; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-plus-circle"></i> Manage Lessons
                    </a>
                    {% endif %}
                </div>
                
                <!-- Lessons List - CLICKABLE VERSION -->
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    {% for lesson in lessons %}
                    <a href="{% url 'courses:lesson_detail' course.slug lesson.id %}" 
                       style="text-decoration: none; display: block;">
                        <div style="background: {% if lesson.is_free_preview %}#f0f9ff{% else %}#f8fafd{% endif %}; border-radius: 16px; padding: 1.25rem; border: 1px solid #e2e8f0; transition: all 0.3s; display: flex; justify-content: space-between; align-items: center;"
                             onmouseover="this.style.borderColor='#8b5cf6'; this.style.boxShadow='0 10px 25px rgba(139, 92, 246, 0.1)'; this.style.transform='translateY(-2px)';"
                             onmouseout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                            
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <!-- Lesson Number/Icon -->
                                <div style="width: 44px; height: 44px; background: {% if lesson.is_free_preview %}#10b981{% else %}#e2e8f0{% endif %}; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: {% if lesson.is_free_preview %}white{% else %}#64748b{% endif %};">
                                    <i class="fas {% if lesson.is_free_preview %}fa-play{% else %}fa-lock{% endif %}"></i>
                                </div>
                                
                                <div>
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.25rem;">
                                        <span style="font-weight: 600; color: #0f172a;">{{ lesson.title }}</span>
                                        {% if lesson.is_free_preview %}
                                        <span style="background: #10b981; color: white; padding: 0.2rem 0.75rem; border-radius: 50px; font-size: 0.7rem; font-weight: 600;">FREE</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div style="display: flex; align-items: center; gap: 1rem; color: #64748b; font-size: 0.85rem;">
                                        <span><i class="far fa-clock"></i> {{ lesson.duration_minutes }} mins</span>
                                        {% if lesson.description %}
                                        <span>•</span>
                                        <span>{{ lesson.description|truncatechars:50 }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <!-- Resource indicator if files exist -->
                                {% if lesson.files_count > 0 %}
                                <span style="color: #8b5cf6; font-size: 0.85rem; display: flex; align-items: center; gap: 0.25rem;">
                                    <i class="fas fa-paperclip"></i> {{ lesson.files_count }}
                                </span>
                                {% endif %}
                                
                                <i class="fas fa-arrow-right" style="color: #8b5cf6; opacity: 0; transition: opacity 0.3s;" 
                                   onmouseover="this.style.opacity='1'" 
                                   onmouseout="this.style.opacity='0'"></i>
                            </div>
                        </div>
                    </a>
                    {% empty %}
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-video" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                        <p style="color: #64748b;">No lessons available yet.</p>
                        {% if user.is_instructor and course.instructor == user %}
                        <a href="{% url 'courses:manage_lessons' course.id %}" style="color: #8b5cf6; text-decoration: none; font-weight: 500; display: inline-block; margin-top: 1rem;">
                            <i class="fas fa-plus-circle"></i> Add your first lesson
                        </a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Course Progress Summary -->
                {% if user.is_authenticated and is_enrolled %}
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e2e8f0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span style="font-weight: 600; color: #0f172a;">Your progress</span>
                        <span style="color: #8b5cf6; font-weight: 600;">{{ course.get_progress_percentage|default:0 }}%</span>
                    </div>
                    <div style="height: 8px; background: #e2e8f0; border-radius: 10px; overflow: hidden;">
                        <div style="width: {{ course.get_progress_percentage|default:0 }}%; height: 100%; background: linear-gradient(90deg, #8b5cf6, #14b8a6);"></div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Reviews Section -->
            <div style="background: white; border-radius: 20px; padding: 2rem; box-shadow: 0 8px 30px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="font-size: 1.5rem; font-weight: 700; color: #0f172a; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-star" style="color: #fbbf24;"></i>
                        Student Reviews
                        {% if course.total_reviews > 0 %}
                        <span style="background: #f1f5f9; color: #334155; padding: 0.25rem 1rem; border-radius: 50px; font-size: 0.9rem; font-weight: normal;">
                            {{ course.total_reviews }} reviews
                        </span>
                        {% endif %}
                    </h2>
                    
                    {% if user.is_authenticated and user.is_student and is_enrolled %}
                    <a href="{% url 'courses:add_course_review' course.id %}" 
                       style="background: #8b5cf6; color: white; padding: 0.75rem 1.5rem; border-radius: 50px; text-decoration: none; font-weight: 500; display: inline-flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-pen"></i> Write a Review
                    </a>
                    {% endif %}
                </div>
                
                <!-- Rating Summary -->
                {% if course.total_reviews > 0 %}
                <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem; margin-bottom: 2rem; background: #f8fafd; border-radius: 16px; padding: 1.5rem;">
                    <!-- Average Rating -->
                    <div style="text-align: center;">
                        <div style="font-size: 4rem; font-weight: 800; color: #0f172a;">{{ course.average_rating|floatformat:1 }}</div>
                        <div style="font-size: 1.5rem; color: #fbbf24; margin-bottom: 0.5rem;">
                            {% for i in "12345"|make_list %}
                                {% if forloop.counter <= course.average_rating|floatformat:"0" %}★{% else %}☆{% endif %}
                            {% endfor %}
                        </div>
                        <div style="color: #64748b;">{{ course.total_reviews }} total reviews</div>
                    </div>
                    
                    <!-- Rating Breakdown -->
                    <div>
                        {% for i in "54321"|make_list %}
                        {% with rating_count=course.reviews.filter.rating__count %}
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span style="min-width: 60px;">{{ i }} star</span>
                            <div style="flex: 1; height: 8px; background: #e2e8f0; border-radius: 10px;">
                                <div style="width: {% widthratio rating_count course.total_reviews 100 %}%; height: 100%; background: #fbbf24; border-radius: 10px;"></div>
                            </div>
                            <span style="min-width: 40px; color: #64748b;">{{ rating_count }}</span>
                        </div>
                        {% endwith %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Reviews List -->
                <div id="reviewsContainer">
                    {% for review in course.reviews.all|slice:":5" %}
                    <div style="border-bottom: 1px solid #e2e8f0; padding: 1.5rem 0; {% if forloop.first %}padding-top: 0;{% endif %}">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #8b5cf6, #14b8a6); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                                    {{ review.student.first_name|first|upper }}{{ review.student.last_name|first|upper }}
                                </div>
                                <div>
                                    <div style="font-weight: 600;">{{ review.student.get_full_name }}</div>
                                    <div style="font-size: 0.9rem; color: #64748b;">{{ review.created_at|date:"F d, Y" }}</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="color: #fbbf24; font-size: 1.1rem;">
                                    {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= review.rating %}★{% else %}☆{% endif %}
                                    {% endfor %}
                                </div>
                                {% if review.is_verified %}
                                <span style="background: #10b981; color: white; padding: 0.2rem 0.5rem; border-radius: 20px; font-size: 0.7rem;">Verified</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if review.title %}
                        <h4 style="font-weight: 600; margin-bottom: 0.5rem;">{{ review.title }}</h4>
                        {% endif %}
                        
                        <p style="color: #334155; line-height: 1.6; margin-bottom: 1rem;">{{ review.comment }}</p>
                        
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button onclick="markHelpful({{ review.id }})" 
                                    style="background: none; border: 1px solid #e2e8f0; padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="far fa-thumbs-up"></i>
                                <span id="helpful-count-{{ review.id }}">{{ review.helpful_votes.count }}</span> found this helpful
                            </button>
                            
                            {% if review.difficulty_rating %}
                            <span style="color: #64748b;">Difficulty: 
                                {% if review.difficulty_rating == 1 %}Very Easy
                                {% elif review.difficulty_rating == 2 %}Easy
                                {% elif review.difficulty_rating == 3 %}Moderate
                                {% elif review.difficulty_rating == 4 %}Hard
                                {% else %}Very Hard{% endif %}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div style="text-align: center; padding: 3rem;">
                        <i class="far fa-star" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                        <h3 style="color: #334155; margin-bottom: 0.5rem;">No reviews yet</h3>
                        <p style="color: #64748b;">Be the first to share your experience with this course!</p>
                        {% if user.is_authenticated and user.is_student and is_enrolled %}
                        <a href="{% url 'courses:add_course_review' course.id %}" class="btn" style="display: inline-block; margin-top: 1rem; background: #8b5cf6; color: white; padding: 0.75rem 2rem; border-radius: 50px; text-decoration: none;">Write a Review</a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Load More Button -->
                {% if course.total_reviews > 5 %}
                <div style="text-align: center; margin-top: 2rem;">
                    <button id="loadMoreBtn" onclick="loadMoreReviews()" 
                            style="background: white; color: #8b5cf6; border: 2px solid #8b5cf6; padding: 0.75rem 2rem; border-radius: 50px; cursor: pointer; font-weight: 500;">
                        Load More Reviews
                    </button>
                </div>
                {% endif %}
            </div>

            <!-- Instructor Review Section -->
            {% if user.is_authenticated and user.is_student and is_enrolled and not has_reviewed_instructor %}
            <div style="margin-top: 2rem; background: linear-gradient(135deg, #8b5cf6, #14b8a6); border-radius: 16px; padding: 1.5rem; color: white;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <h3 style="font-weight: 600; margin-bottom: 0.25rem;">Review Your Instructor</h3>
                        <p style="opacity: 0.9;">Help others by sharing your experience with {{ course.instructor.get_full_name }}</p>
                    </div>
                    <a href="{% url 'courses:add_instructor_review' course.id course.instructor.id %}" 
                       style="background: white; color: #8b5cf6; padding: 0.75rem 1.5rem; border-radius: 50px; text-decoration: none; font-weight: 500;">
                        Write Instructor Review
                    </a>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Right Column - Sidebar -->
        <div>
            <!-- Instructor Card -->
            <div style="background: white; border-radius: 20px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 8px 30px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <h3 style="font-size: 1.2rem; font-weight: 700; color: #0f172a; margin-bottom: 1.5rem;">Your Instructor</h3>
                
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #8b5cf6, #14b8a6); border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">
                        {{ course.instructor.first_name|first|upper }}{{ course.instructor.last_name|first|upper }}
                    </div>
                    <div>
                        <div style="font-weight: 700; color: #0f172a;">{{ course.instructor.get_full_name }}</div>
                        <div style="color: #64748b; font-size: 0.9rem;">{{ course.instructor.expertise|default:"Course Instructor" }}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                            <div style="color: #fbbf24;">
                                {% if course.instructor.instructor_rating %}
                                    {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= course.instructor.instructor_rating %}★{% else %}☆{% endif %}
                                    {% endfor %}
                                {% else %}
                                    No ratings yet
                                {% endif %}
                            </div>
                            <span style="color: #64748b; font-size: 0.8rem;">({{ course.instructor.total_instructor_reviews|default:0 }} reviews)</span>
                        </div>
                    </div>
                </div>
                
                <p style="color: #475569; line-height: 1.6; margin-bottom: 1rem;">
                    {{ course.instructor.bio|default:"Experienced instructor passionate about teaching and helping students succeed." }}
                </p>
                
                <div style="display: flex; gap: 1rem; color: #64748b; font-size: 0.9rem;">
                    <span><i class="fas fa-star" style="color: #fbbf24;"></i> {{ course.instructor.instructor_rating|default:"0" }} Instructor Rating</span>
                    <span><i class="fas fa-users"></i> {{ course.instructor.total_students|default:"0" }} Students</span>
                </div>
            </div>

            <!-- What's Included -->
            <div style="background: white; border-radius: 20px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 8px 30px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <h3 style="font-size: 1.2rem; font-weight: 700; color: #0f172a; margin-bottom: 1.5rem;">This course includes:</h3>
                
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 36px; height: 36px; background: #f0f9ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #8b5cf6;">
                            <i class="fas fa-video"></i>
                        </div>
                        <span>{{ total_duration }} minutes of video</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 36px; height: 36px; background: #f0f9ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #8b5cf6;">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <span>{{ lessons|length }} downloadable lessons</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 36px; height: 36px; background: #f0f9ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #8b5cf6;">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <span>Certificate of completion</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 36px; height: 36px; background: #f0f9ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #8b5cf6;">
                            <i class="fas fa-infinity"></i>
                        </div>
                        <span>Full lifetime access</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 36px; height: 36px; background: #f0f9ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #8b5cf6;">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <span>Access on mobile and TV</span>
                    </div>
                </div>
            </div>

            <!-- Requirements -->
            <div style="background: white; border-radius: 20px; padding: 2rem; box-shadow: 0 8px 30px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <h3 style="font-size: 1.2rem; font-weight: 700; color: #0f172a; margin-bottom: 1.5rem;">Requirements</h3>
                
                <ul style="list-style: none; padding: 0;">
                    <li style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                        <span>No prior experience needed</span>
                    </li>
                    <li style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                        <span>A computer with internet connection</span>
                    </li>
                    <li style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                        <span>Willingness to learn</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    function markHelpful(reviewId) {
        fetch(`/courses/reviews/${reviewId}/helpful/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const countElement = document.getElementById(`helpful-count-${reviewId}`);
                countElement.textContent = data.count;
                
                // Optional: Add animation
                countElement.style.transition = 'transform 0.2s';
                countElement.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    countElement.style.transform = 'scale(1)';
                }, 200);
            }
        })
        .catch(error => console.error('Error:', error));
    }
    
    let currentPage = 1;
    
    function loadMoreReviews() {
        currentPage++;
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        loadMoreBtn.textContent = 'Loading...';
        loadMoreBtn.disabled = true;
        
        fetch(`/courses/{{ course.id }}/reviews/load-more/?page=${currentPage}`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('reviewsContainer');
            
            data.reviews.forEach(review => {
                const reviewHtml = createReviewHtml(review);
                container.insertAdjacentHTML('beforeend', reviewHtml);
            });
            
            if (!data.has_more) {
                loadMoreBtn.style.display = 'none';
            } else {
                loadMoreBtn.textContent = 'Load More Reviews';
                loadMoreBtn.disabled = false;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            loadMoreBtn.textContent = 'Load More Reviews';
            loadMoreBtn.disabled = false;
        });
    }
    
    function createReviewHtml(review) {
        const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
        const verifiedBadge = review.is_verified ? 
            '<span style="background: #10b981; color: white; padding: 0.2rem 0.5rem; border-radius: 20px; font-size: 0.7rem; margin-left: 0.5rem;">Verified</span>' : '';
        
        const difficultyText = review.difficulty_rating ? 
            `<span style="color: #64748b;">Difficulty: ${
                review.difficulty_rating === 1 ? 'Very Easy' :
                review.difficulty_rating === 2 ? 'Easy' :
                review.difficulty_rating === 3 ? 'Moderate' :
                review.difficulty_rating === 4 ? 'Hard' : 'Very Hard'
            }</span>` : '';
        
        return `
            <div style="border-bottom: 1px solid #e2e8f0; padding: 1.5rem 0;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #8b5cf6, #14b8a6); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                            ${review.student_name.charAt(0)}${review.student_name.split(' ')[1]?.charAt(0) || ''}
                        </div>
                        <div>
                            <div style="font-weight: 600;">${review.student_name}</div>
                            <div style="font-size: 0.9rem; color: #64748b;">${review.date}</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="color: #fbbf24; font-size: 1.1rem;">${stars}</div>
                        ${verifiedBadge}
                    </div>
                </div>
                
                ${review.title ? `<h4 style="font-weight: 600; margin-bottom: 0.5rem;">${review.title}</h4>` : ''}
                
                <p style="color: #334155; line-height: 1.6; margin-bottom: 1rem;">${review.comment}</p>
                
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button onclick="markHelpful(${review.id})" 
                            style="background: none; border: 1px solid #e2e8f0; padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="far fa-thumbs-up"></i>
                        <span id="helpful-count-${review.id}">${review.helpful_count}</span> found this helpful
                    </button>
                    
                    ${difficultyText}
                </div>
            </div>
        `;
    }
</script>

<style>
    /* Hover effects */
    div[style*="transition: all 0.3s"]:hover {
        transition: all 0.3s ease;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: #f1f5f9;
    }
    
    ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
    
    /* Button hover effects */
    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
</style>
{% endblock %}